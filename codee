/**
 * Parse a SQL row’s LocaleMessageTime (which may be a Date or string) into a Luxon DateTime in UTC.
 */
function parseRowUtcDateTime(raw) {
  if (!raw) return null;

  // If it's already a JS Date
  if (raw instanceof Date) {
    return DateTime.fromJSDate(raw, { zone: 'utc' });
  }

  // If it's a string (e.g. "2025-09-10T01:23:45.000Z")
  if (typeof raw === 'string') {
    return DateTime.fromISO(raw, { zone: 'utc' });
  }

  // Fallback: try to construct a Date
  try {
    const d = new Date(raw);
    if (!Number.isNaN(d.getTime())) {
      return DateTime.fromJSDate(d, { zone: 'utc' });
    }
  } catch (err) {
    console.warn('⚠️ parseRowUtcDateTime failed for', raw, err);
  }

  return null;
}