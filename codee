let detailsToday = [];
const summaryMap = {};

// filter today's details
if (Array.isArray(payload.details)) {
  detailsToday = payload.details.filter(d => {
    const raw = d.LocaleMessageTime || d.DateOnly || '';
    const recDate = extractIsoDate(raw);
    return recDate === todayDenver;
  });

  // build summary only from detailsToday
  detailsToday.forEach(d => {
    const derived = deriveFloorFromRecord(d) || 'Unknown';
    const key = normalizeFloorName(derived);
    summaryMap[key] = (summaryMap[key] || 0) + 1;
  });
}