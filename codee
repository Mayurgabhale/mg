  const handleExport = () => {
    const ws = XLSX.utils.json_to_sheet(
      detailRows.map((r, i) => ({
        Sr: i + 1,
        // use the raw API date part (no timezone conversion)
        Date: r.LocaleMessageTime ? r.LocaleMessageTime.slice(0, 10) : '',
        // use the same helper as the UI so Excel matches frontend (12-hour, no TZ conversion)
        Time: formatApiTime12(r.LocaleMessageTime),
        EmployeeID: r.EmployeeID,
        CardNumber: r.CardNumber,
        Name: r.ObjectName1,
        PersonnelType: r.PersonnelType,
        CompanyName: r.CompanyName,
        PrimaryLocation: r.PrimaryLocation,
        Door: r.Door,
        Partition: formatPartition(r.PartitionNameFriendly)
      }))
    );
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'Details');
    const buf = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });
    saveAs(new Blob([buf]), `apac_history_${format(pickedDate, 'yyyyMMdd')}.xlsx`);
  };
