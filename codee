const details = result.recordset.map(r => {
  let floor = r.PartitionName2; // default fallback
  try {
    const [doorRaw, dirRaw] = (r.Door || "").split("___");
    const normKey = normalizeKey(doorRaw || "", dirRaw || "");
    if (doorFloorMap[normKey]) {
      floor = doorFloorMap[normKey];
    }
  } catch (e) {
    console.warn("Failed to normalize door:", r.Door, e.message);
  }

  return { ...r, floor };
});
