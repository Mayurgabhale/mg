// 4. Final query
const query = `
    WITH Hist AS (
      ${unionQueries}
    ),
    Enriched AS (
      SELECT
        Hist.*,
        MIN(LocaleMessageTime) OVER (PARTITION BY PersonGUID) AS FirstSwipe,
        MAX(LocaleMessageTime) OVER (PARTITION BY PersonGUID) AS LastSwipe,
        DATEDIFF(SECOND,
          MIN(LocaleMessageTime) OVER (PARTITION BY PersonGUID),
          MAX(LocaleMessageTime) OVER (PARTITION BY PersonGUID)
        ) AS DurationSeconds
      FROM Hist
    )
    SELECT *
    FROM Enriched
    ${outerFilter}
    ORDER BY LocaleMessageTime ASC;
  `;



