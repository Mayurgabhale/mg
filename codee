const sseBufferRef = useRef(null);
const sseFlushScheduledRef = useRef(false);

es.onmessage = (e) => {
  const p = JSON.parse(e.data);
  sseBufferRef.current = p;
  if (!sseFlushScheduledRef.current) {
    sseFlushScheduledRef.current = true;
    setTimeout(() => {
      setPayload(sseBufferRef.current);
      sseFlushScheduledRef.current = false;
    }, 300);
  }
};